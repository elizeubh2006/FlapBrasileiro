const t=Math.PI/180,s=document.getElementById("canvas"),i=s.getContext("2d");s.tabIndex=1,s.addEventListener("click",(()=>{switch(a.atual){case a.preparese:a.atual=a.Play,r.start.play(),o();break;case a.Play:d.flap();break;case a.fimDeJogo:a.atual=a.preparese,d.speed=0,d.y=100,g.pipes=[],w.score.atual=0,r.played=!1,o()}})),s.onkeydown=function(t){if(32==t.keyCode||87==t.keyCode||38==t.keyCode)switch(a.atual){case a.preparese:a.atual=a.Play,r.start.play();break;case a.Play:d.flap();break;case a.fimDeJogo:a.atual=a.preparese,d.speed=0,d.y=100,g.pipes=[],w.score.atual=0,r.played=!1}};let h=0,e=2;const a={atual:0,preparese:0,Play:1,fimDeJogo:2},n=document.getElementById("topbar");function o(){a.atual===a.Play?n.classList.add("hidden"):n.classList.remove("hidden")}const r={start:new Audio,flap:new Audio,score:new Audio,hit:new Audio,die:new Audio,played:!1},c={sprite:new Image,x:0,y:0,draw:function(){this.y=parseFloat(s.height-this.sprite.height),i.drawImage(this.sprite,this.x,this.y)},update:function(){a.atual==a.Play&&(this.x-=e,this.x=this.x%(this.sprite.width/2))}},p={sprite:new Image,x:0,y:0,speed:.3,get tileWidth(){return this.sprite.width/2},draw:function(t){t.drawImage(this.sprite,this.x,this.y),t.drawImage(this.sprite,this.x+this.tileWidth,this.y)},update:function(){a.atual===a.Play&&(this.x-=this.speed,this.x<=-this.tileWidth&&(this.x+=this.tileWidth))}},u={sprite:new Image,x:0,y:0,speed:.1,tileWidth:369,draw:function(t,s){this.y=s-this.sprite.height,t.drawImage(this.sprite,this.x,this.y),t.drawImage(this.sprite,this.x+this.tileWidth,this.y)},update:function(){a.atual===a.Play&&(this.x-=this.speed,this.x<=-this.tileWidth&&(this.x+=this.tileWidth))}},g={top:{sprite:new Image},bot:{sprite:new Image},gap:95,moved:!0,pipes:[],draw:function(){for(let t=0;t<this.pipes.length;t++){let s=this.pipes[t];i.drawImage(this.top.sprite,s.x,s.y),i.drawImage(this.bot.sprite,s.x,s.y+parseFloat(this.top.sprite.height)+this.gap)}},update:function(){a.atual==a.Play&&(h%100==0&&this.pipes.push({x:parseFloat(s.width),y:-210*Math.min(Math.random()+1,1.8)}),this.pipes.forEach((t=>{t.x-=e})),this.pipes.length&&this.pipes[0].x<-this.top.sprite.width&&(this.pipes.shift(),this.moved=!0))}},d={animations:[{sprite:new Image},{sprite:new Image},{sprite:new Image},{sprite:new Image},{sprite:new Image}],rotatation:0,x:50,y:100,speed:0,gravity:.125,thrust:3.6,frame:0,draw:function(){4==this.frame&&a.atual!=a.fimDeJogo&&(this.frame=0);let s=this.animations[this.frame].sprite.height,h=this.animations[this.frame].sprite.width;i.save(),i.translate(this.x,this.y),i.rotate(this.rotatation*t),i.drawImage(this.animations[this.frame].sprite,-h/2,-s/2),i.restore()},update:function(){let s=parseFloat(this.animations[0].sprite.width)/2;switch(a.atual){case a.preparese:this.rotatation=0,this.y+=h%10==0?Math.sin(h*t):0,this.frame+=h%10==0?1:0;break;case a.Play:this.frame+=h%5==0?1:0,this.y+=this.speed,this.setRotation(),this.speed+=this.gravity,(this.y+s>=c.y||this.collisioned())&&(a.atual=a.fimDeJogo);break;case a.fimDeJogo:this.frame=4,this.y+s<c.y?(this.y+=this.speed,this.setRotation(),this.speed+=2*this.gravity):(this.speed=0,this.y=c.y-s,this.rotatation=90,r.played||(r.die.play(),r.played=!0))}this.frame=this.frame%this.animations.length},flap:function(){this.y>0&&(r.flap.play(),this.speed=-this.thrust)},setRotation:function(){this.speed<=0?this.rotatation=Math.max(-25,-25*this.speed/(-1*this.thrust)):this.speed>0&&(this.rotatation=Math.min(90,90*this.speed/(2*this.thrust)))},collisioned:function(){if(!g.pipes.length)return;let t=this.animations[4].sprite,s=g.pipes[0].x,i=g.pipes[0].y,h=t.height/4+t.width/4,e=i+parseFloat(g.top.sprite.height),a=e+g.gap,n=parseFloat(g.top.sprite.width);if(this.x+h>=s)if(this.x+h<s+n){if(this.y-h<=e||this.y+h>=a)return r.hit.play(),!0}else g.moved&&(w.score.atual++,r.score.play(),g.moved=!1)}},w={preparese:{sprite:new Image},fimDeJogo:{sprite:new Image},toque:[{sprite:new Image},{sprite:new Image}],score:{atual:0,best:0},x:0,y:0,tx:0,ty:0,frame:0,draw:function(){switch(a.atual){case a.preparese:this.y=parseFloat(s.height-this.preparese.sprite.height)/2,this.x=parseFloat(s.width-this.preparese.sprite.width)/2,this.tx=parseFloat(s.width-this.toque[0].sprite.width)/2,this.ty=this.y+this.preparese.sprite.height-this.toque[0].sprite.height,i.drawImage(this.preparese.sprite,this.x,this.y),i.drawImage(this.toque[this.frame].sprite,this.tx,this.ty);break;case a.fimDeJogo:this.y=parseFloat(s.height-this.fimDeJogo.sprite.height)/2,this.x=parseFloat(s.width-this.fimDeJogo.sprite.width)/2,this.tx=parseFloat(s.width-this.toque[0].sprite.width)/2,this.ty=this.y+this.fimDeJogo.sprite.height-this.toque[0].sprite.height,i.drawImage(this.fimDeJogo.sprite,this.x,this.y),i.drawImage(this.toque[this.frame].sprite,this.tx,this.ty)}this.drawScore()},drawScore:function(){switch(i.fillStyle="#FFFFFF",i.strokeStyle="#000000",a.atual){case a.Play:i.lineWidth="2",i.font="35px Squada One",i.fillText(this.score.atual,s.width/2-5,50),i.strokeText(this.score.atual,s.width/2-5,50);break;case a.fimDeJogo:i.lineWidth="2",i.font="40px Squada One";let t=`PONTOS :  ${this.score.atual}`;try{this.score.best=Math.max(this.score.atual,localStorage.getItem("best")),localStorage.setItem("best",this.score.best);let h=`RECORDE  :  ${this.score.best}`;i.fillText(t,s.width/2-80,s.height/2+0),i.strokeText(t,s.width/2-80,s.height/2+0),i.fillText(h,s.width/2-80,s.height/2+30),i.strokeText(h,s.width/2-80,s.height/2+30)}catch(h){i.fillText(t,s.width/2-85,s.height/2+15),i.strokeText(t,s.width/2-85,s.height/2+15)}}},update:function(){a.atual!=a.Play&&(this.frame+=h%10==0?1:0,this.frame=this.frame%this.toque.length)}};function f(){l(),m(),h++}function l(){d.update(),c.update(),p.update(),u.update(),g.update(),w.update()}function m(){i.fillStyle="#30c0df",i.fillRect(0,0,s.width,s.height),p.draw(i),u.draw(i,s.height),g.draw(),d.draw(),c.draw(),w.draw()}function v(){const t=document.getElementById("canvas"),s=t.width,i=t.height;let h;h=window.innerWidth>window.innerHeight?window.innerHeight/i:window.innerWidth/s,t.style.width=s*h+"px",t.style.height=i*h+"px"}c.sprite.src="img/piso.png",p.sprite.src="img/backGround.svg",u.sprite.src="img/Clouds.svg",g.top.sprite.src="img/tuboCima.png",g.bot.sprite.src="img/tuboBaixo.png",w.fimDeJogo.sprite.src="img/fimDeJogo.svg",w.preparese.sprite.src="img/Prepareâ€‘se.svg",w.toque[0].sprite.src="img/toque/t0.svg",w.toque[1].sprite.src="img/toque/t1.svg",d.animations[0].sprite.src="img/passaro/P0.svg",d.animations[1].sprite.src="img/passaro/P1.svg",d.animations[2].sprite.src="img/passaro/P2.svg",d.animations[3].sprite.src="img/passaro/P0.svg",d.animations[4].sprite.src="img/passaro/PMorto.svg",r.start.src="sfx/start.wav",r.flap.src="sfx/flap.wav",r.score.src="sfx/score.wav",r.hit.src="sfx/hit.wav",r.die.src="sfx/die.wav",setInterval(f,20),window.addEventListener("load",v),window.addEventListener("resize",v);